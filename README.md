# relaxed_ik_ros1
## About
This is the ROS wrapper of RelaxedIK solver. Here is the project page that has more information about RelaxedIK that you may want to know about: https://uwgraphics.github.io/relaxed_ik_core/

This is a lighter-weight version of RelaxedIK wrapped up in ROS1 with pre-generated config files of some mostly used robot arms. A keyboard pose goal driver and a rviz viewer are included in this wrapper for you to play with. However, you will not be able to customize your own config files in this wrapper. You can go to this link instead [relaxed_ik](https://github.com/uwgraphics/relaxed_ik) for the complete version. In the complete version, you will have the opportunity to (and have to) set up everything from scratch, including importing a urdf, configuring the collision files, and training the neural network, etc. The complete version is recommended if you would like to work on the configuration process yourself or a robot that we didnâ€™t include in the available options; otherwise, this wrapper is likely to make your life much easier since everything you need to do will be setting the name of the robot you would like to work with.

**UPDATE:** Based on our CollisionIK paper, we add the feature of simultaneously avoiding collisions with static or dynamic obstacles in the environment to RelaxedIK. This method effectively incorporates environment collision avoidance as a single term in this multi-objective, optimization-based IK structure, and provide solutions for how to spatially represent and organize external environments such that data can be efficiently passed to a real-time, performancecritical optimization loop.

## Dependencies
### Python Dependencies (Not Optional)
kdl urdf parser:
```
sudo apt-get install ros-[your ros distro]-urdfdom-py
sudo apt-get install ros-[your ros distro]-kdl-parser-py
sudo apt-get install ros-[your ros distro]-kdl-conversions 
```

readchar:
```
sudo pip install readchar
```

fcl collision library:
https://github.com/BerkeleyAutomation/python-fcl
```
sudo pip install python-fcl
```

scikit learn:
http://scikit-learn.org/stable/index.html
```
sudo pip install scikit-learn
```

scipy:
```
sudo pip install scipy
```

Pyyaml:
```
sudo pip install PyYaml
```

Lastly, update your version of numpy:
```
sudo pip install --upgrade numpy
```

Pypcd:
https://github.com/dimatura/pypcd

### Rust Dependencies (Not Optional)
To use this wrapper, you will first need to install Rust. Please go to https://www.rust-lang.org/learn/get-started for more infomation.

## Install
1. Install all the dependencies.
1. Clone this repo to the src directory in your ROS workspace.
1. Initialize relaxed_ik_core (the core part of relaxed IK written in Rust) as a submodule by running the following command from the project directory: 
	```
	git submodule update --init
	```
1. Compile relaxed_ik_core (the core part of relaxed IK written in Rust) by running the following command from the project directory:
	```
    cd ./relaxed_ik_core
	cargo build
    ```
1. Build your ROS workspace.

## Configuration
1. Now available robots include baxter, hubo, iiwa7, jaco7, panda, sawyer, ur5 and yumi. If you would like to use your own config files for a robot that we provided config files in relaxed_ik_core/config or work on a new robot that we didn't provide config files, please go to [relaxed_ik](https://github.com/uwgraphics/relaxed_ik) to generate required config files. After you have those files, put the corresponding config files (generated by relaxed_ik) into each subfolder in relaxed_ik_core/config. Replace the given files if you are updating config files for a provided robot. You can skip this step if you would like to work on a robot whose config files are provided by us. 
1. All the configurations are set up in [relaxed_ik_core/config/settings.yaml](https://github.com/uwgraphics/relaxed_ik_core/blob/dev/config/settings.yaml). Please take a look at this file before you try to run the solver. More detailed instructions are provided there.

## Run
1. View the robot arm in rviz by running the following command:
    ```
    roslaunch relaxed_ik_ros1 rviz_viewer.launch
    ```
1. Open a new terminal and launch the RelaxedIK solver: 
    ```
    roslaunch relaxed_ik_ros1 relaxed_ik_rust.launch
    ```
1. Set the ROS parameter /simulation_time as go:
    ```
    rosparam set /simulation_time go
    ```
1. Control the robot based on the type of input device in the settings.yaml:
	+ If you set the robot follow a cartesian path, you should see the robot moving now!
	+ If you set the input_device to be keyboard, initialize the keyboard IK goal driver in a new terminal:
		```
		rosrun relaxed_ik_ros1 keyboard_ikgoal_driver.py
		```
		To use the keyboard controller, please ensure that the termainal window where the keyboard_ikgoal_driver script was run from has focus (i.e., make sure it's clicked), then use the following keystrokes: 
		```
		c - kill the controller controller script
		w - move chain 1 along +X
		x - move chain 1 along -X
		a - move chain 1 along +Y
		d - move chain 1 along -Y
		q - move chain 1 along +Z
		z - move chain 1 along -Z
		1 - rotate chain 1 around +X
		2 - rotate chain 1 around -X
		3 - rotate chain 1 around +Y
		4 - rotate chain 1 around -Y
		5 - rotate chain 1 around +Z
		6 rotate chain 1 around -Z

		i - move chain 2 along +X
		m - move chain 2 along -X
		j - move chain 2 along +Y
		l - move chain 2 along -Y
		u - move chain 2 along +Z
		n - move chain 2 along -Z
		= - rotate chain 2 around +X
		- - rotate chain 2 around -X
		0 - rotate chain 2 around +Y
		9 - rotate chain 2 around -Y
		8 - rotate chain 2 around +Z
		7 - rotate chain 2 around -Z
		```
		